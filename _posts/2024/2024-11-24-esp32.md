---
layout: post
title: ESP32 & Car Robots
comments: true
tags: [DEV]
---

* [Introduction](#lintrto)
* [ESP32 communication](#espcom)
* [ESP32-CAM](#espcam)
* [ESP32-CANBUS](#espcan)
* [Car Robots](#carbot)
* [Problems](#prob)


<a name="lintrto"></a>
## Introduction

ESP32 is a series of low-cost, low-power system-on-chip microcontrollers with integrated Wi-Fi and dual-mode Bluetooth.

<div align="center">    
<img src="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2022/10/ESP32-Devleopment-boards.jpg?w=750&quality=100&strip=all&ssl=1" width="64%"/>
</div>

[Getting Started with the ESP32 Development Board](https://randomnerdtutorials.com/getting-started-with-esp32/):

Main Features:
* **Low-cost**: you can get an ESP32 starting at $6, which makes it easily accessible to the general public;
* **Low-power**: the ESP32 consumes very little power compared with other microcontrollers, and it supports low-power mode states like deep sleep to save power;
* [Wi-Fi capabilities](https://randomnerdtutorials.com/esp32-useful-wi-fi-functions-arduino/), wifi connect or wifi host.
* **Bluetooth** : supports [Bluetooth classic](https://randomnerdtutorials.com/esp32-bluetooth-classic-arduino-ide/) and [Bluetooth Low Energy (BLE)](https://randomnerdtutorials.com/esp32-bluetooth-low-energy-ble-arduino-ide/) (100x less power).
* GPIO : [ESP32 Pinout Reference](https://randomnerdtutorials.com/esp32-pinout-reference-gpios/)
* Processor: Tensilica Xtensa Dual-Core 32-bit LX6 microprocessor, running at 160 or 240 MHz. The ESP32 is the ESP8266 successor.
* ESP32 Development Boards come with all the needed circuitry to power and program the chip.
* [Compatible with the Arduino “programming language”](https://randomnerdtutorials.com/installing-esp32-arduino-ide-2-0/).
  * [Installing ESP32 Board in Arduino IDE 2](https://randomnerdtutorials.com/installing-esp32-arduino-ide-2-0/)
* [Compatible with MicroPython](https://randomnerdtutorials.com/getting-started-micropython-esp32-esp8266/).


### **Comparison: ESP32 vs ESP32-S3 vs ESP8266**  
<p></p>

| Feature          | **ESP8266** | **ESP32** | **ESP32-S3** |
|-----------------|------------|-----------|-------------|
| **Processor** | 80 MHz, single-core (Tensilica L106) | 240 MHz, dual-core (Xtensa LX6) | 240 MHz, dual-core (Xtensa LX7) |
| **RAM** | ~80 KB | 520 KB SRAM | 512 KB SRAM + 8 MB PSRAM (optional) |
| **Flash** | Up to 16 MB (external) | Up to 16 MB (external) | Up to 16 MB (external) |
| **Wi-Fi** | 2.4 GHz, 802.11 b/g/n | 2.4 GHz, 802.11 b/g/n | 2.4 GHz, 802.11 b/g/n |
| **Bluetooth** | ❌ | BT 4.2 + BLE | BT 5 + BLE |
| **USB Support** | ❌ | ❌ | USB OTG (Native) |
| **GPIO Pins** | ~11 usable | 34 (some have special functions) | 45 (some have special functions) |
| **ADC Channels** | 1x 10-bit | 18x 12-bit | 20x 12-bit |
| **SPI/I2C/I2S/UART** | 2x SPI, 1x I2C, 2x UART | 4x SPI, 2x I2C, 2x I2S, 3x UART | 4x SPI, 2x I2C, 2x I2S, 3x UART |
| **PWM** | Yes | Yes | Yes |
| **Deep Sleep Power** | ~20 µA | ~10 µA | ~10 µA |
| **PSRAM (Extra RAM)** | ❌ | Optional (up to 8MB) | Optional (8MB default on some models) |
| **AI/ML Acceleration** | ❌ | ❌ | Yes (Vector instructions) |
| **Security Features** | Basic | Secure Boot, Flash Encryption | Secure Boot, Flash Encryption, AES-256 |
| **Price (approx.)** | $2-$4 | $5-$8 | $6-$10 |

✅ **ESP8266** – Best for simple IoT applications where low cost and Wi-Fi are enough (e.g., smart switches, basic sensors).  
✅ **ESP32** – Good for general-purpose IoT, dual-core performance, Bluetooth support, and power-efficient applications.  
✅ **ESP32-S3** – Ideal for advanced applications requiring AI acceleration, more GPIOs, USB support, and improved power efficiency.  

<a name="espcom"></a>
## ESP32 communication

[Comparative Performance Study of ESP-NOW, WiFi, Bluetooth](https://doc-pak.undip.ac.id/id/eprint/24998/1/Article_Comparative_Study.pdf) (classic BT is used in the paper, which similar to WIFI, is designed to transmit data continuously)

<img src="../assets/post_image/esp_communicate.png" alt="yuan" class="mx-auto d-block" width="50%">

* [ESP-NOW](https://randomnerdtutorials.com/esp-now-esp32-arduino-ide/), [ESP32: ESP-NOW Web Server Sensor Dashboard (ESP-NOW + Wi-Fi)](https://randomnerdtutorials.com/esp32-esp-now-wi-fi-web-server/)
* Bluetooth [Two-Way Serial Bluetooth communication between two ESP32 boards](https://ok1tk.com/two-way-serial-bluetooth-communication-between-two-esp32-boards/)

<a name="espcam"></a>
## ESP32-CAM

[Compatible with the Arduino “programming language”](https://randomnerdtutorials.com/installing-esp32-arduino-ide-2-0/).
1. [Installing ESP32 Board in Arduino IDE 2](https://randomnerdtutorials.com/installing-esp32-arduino-ide-2-0/). (attention if you are in a virtual env, when you try to install dependent python libs), install [ESP32](https://docs.espressif.com/projects/arduino-esp32/en/latest/installing.html).
  * [Arduino IDE 2.3.3 has a bug](https://forum.arduino.cc/t/very-long-compiling-time-and-lockup-downloading-with-esp32/1310525) that causes index downloads and installation/updates of boards platforms libraries to hang when Serial Monitor is open.
2. Use board **AI-Thinker ESP32-CAM**.
3. Try the example code project: [ESP32-CAM Take Photo and Display in Web Server](https://randomnerdtutorials.com/esp32-cam-take-photo-display-web-server/).

Documents:
* [ESP32S3 CAM资料链接](https://pan.baidu.com/s/1Bh97f4TClTLBoNzQciallQ?pwd=8889)
* [ESP32-WROVER-DEV+ESP32-CAM学习资料](https://pan.baidu.com/s/1sS52Y4oghFh8jwgl9YQ3eg?pwd=8889)
* [ESP32-S3-Touch-LCD-1.46](https://www.waveshare.net/wiki/ESP32-S3-Touch-LCD-1.46)

<a name="espcan"></a>
## ESP32-CANBUS

<img style="float: right;" src="https://www.flexihub.com/images/upload/flexihub/articles/diagnostics/pinout_explanation.jpg" width="30%"/>

[OBD 2 Pinout Explained](https://www.flexihub.com/oobd2-pinout/)

* CAN transceiver module :
  * [MCP2551](https://www.microchip.com/en-us/product/mcp2551).
  * [SN65HVD230](https://www.waveshare.com/wiki/SN65HVD230_CAN_Board) : 3.3V, has standby mode.
  * [TJA1050](https://www.nxp.com/products/interfaces/can-transceivers/legacy-can/high-speed-can-transceiver:TJA1050) : 5V, lower electromagnetic emission, no standby mode.
* Power source (car battery via 12V->5V converter).
* OBD-II to DB9 or bare wire cable (for connecting to car’s OBD-II port)

<a name="carbot"></a>
## Car Robots
<p></p>

* [梦丘MOS精灵机器人](https://mosbot.taobao.com/shop/view_shop.htm?appUid=RAzN8HWV31nvD1VhREFJicmebPCDNKsTzJgGCoyHbycR49sgMaR) ￥100 (using [ESP8266](https://randomnerdtutorials.com/how-to-install-esp8266-board-arduino-ide/)).
* [DASAI MOCHI](https://dasai.com.au/products/mochi-3) HK$426 .
* 小米SU7官方配件智能双表盘 - ￥699. （车速、里程、表情）
* [蔚来 NOMI](https://www.nio.cn/videos/20240814002) ￥4900 .


<a name="prob"></a>
## Problems

* LVGL with SD_MCC file reading.
  * <u>File system</u> : LVGL's file system template does not fit SD_MCC fs::File. we need to customize the file system functions for GIF files.
  * <u>Memory</u> : ESP32 memory might not be sufficient, `lv_mem_alloc` could fail - we need to enlarge memory size.
* [LVGL Too Slow? Do THIS for Maximum FPS!](https://youtu.be/K42VbYoDgjU?si=YL6fLiffgvvidCpW)
  1. (1) Use DMA (direct memory access), without involving CPU. (2) Double buffering, which gives mixed result. (2) Avoid full screen render mode.
    * `static lv_color_t* draw_buf = (lv_color_t*)heap_caps_aligned_alloc(32, (LCD_WIDTH * LCD_HEIGHT * 2) / 6, MALLOC_CAP_DMA);`
    * `lv_display_set_buffers(disp, draw_buf_1, draw_buf_2, (LCD_WIDTH * LCD_HEIGHT) / 6, LV_DISPLAY_RENDER_MODE_PARTIAL);`
  2. Use LVGL9 (or take care using Meters in LVGL8).
  3. Active vs. Passive components. To limit active changing components.
  4. Increase LVGL limit : `LV_DEF_REFR_PERIOD`.
